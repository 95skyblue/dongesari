<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "test">
	
	<select id="checkIdFromMember" parameterType="String" resultType="int">
		SELECT count(*)
		FROM member
		WHERE "login_id" = #{loginId}	
	</select>
	
	<select id="checkIdFromMemQuit" parameterType="String" resultType="int">
		SELECT count(*)
		FROM mem_quitted
		WHERE "login_id" = #{loginId}	
	</select>
	
	<select id="checkNickname" parameterType="String" resultType="int">
		SELECT count(*)
		FROM member
		WHERE "nickname" = #{nickname}
	</select>
	
	<insert id = "storeEmailAuth" parameterType="emailAuthVO">
		insert into email_auth_test (seq_id, email, code, expire_at, verified, auth_token)
		values(email_auth_seq.nextval, #{email}, #{code}, sysdate + INTERVAL '5' minute, 'N', #{authToken})
	</insert>
	
	<select id = "checkEmailAuth" parameterType="emailAuthVO" resultType="int">
		select count(*)
		from email_auth_test
		where email = #{email} and code = #{code} and auth_token = #{authToken}
	</select>
	
	<insert id="insertAddress" parameterType="addressVO">
	    <selectKey resultType="int" keyProperty="addrId" order="BEFORE">
	        SELECT address_seq.NEXTVAL FROM dual
	    </selectKey>
	    
	    INSERT INTO address ("addr_id", "zipcode", "base_addr", "plus_addr")
	    VALUES (#{addrId}, #{zipcode}, #{baseAddr}, #{plusAddr})
	</insert>
	
	<insert id="insertMember" parameterType="memberVO">
		insert into member("mem_id", "login_id", "password", "name", "nickname", "email", "addr_id")
		values (member_seq.nextval, #{loginId}, #{password}, #{name}, #{nickname}, #{email}, #{addrId})
	</insert>
	
</mapper>